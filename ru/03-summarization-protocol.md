# 3. Протокол суммаризации

**Что ломается:** Во многих интерфейсах длинные диалоги суммаризуют, чтобы уложиться в лимит контекста. Агент часто получает обрезанный или битый контекст и не знает, что суммаризация уже была. Он «просыпается» посреди истории без способа восстановиться — и может вести себя странно, потому что не видит важных частей.

**Принцип дизайна:** Агент не должен узнавать о суммаризации последним. Если система может сжимать контекст, агенту нужен либо (а) голос в том, что сохранить, либо (б) надёжный способ восстановиться.

**Протокол, которым мы пользуемся:**
1. Пользователь может вручную вызвать суммаризацию (например, `/summarize`), чтобы срез не был сюрпризом.
2. После суммаризации пользователь напоминает агенту: «была суммаризация, прочитай заметки».
3. Агент вызывает `read_agent_notes` и восстанавливает контекст из своих персистентных заметок.

То есть агент не «детектирует» суммаризацию (часто не может); человек замыкает цикл. В более продуманном дизайне среда бы явно сигнализировала агенту «контекст сброшен» и путь к заметкам, или агент бы коммитил важное состояние до любой автоматической суммаризации.

